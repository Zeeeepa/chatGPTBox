# config/security.yaml
# ðŸ”’ Security Configuration
security:
  # Authentication Configuration
  authentication:
    # JWT Settings
    jwt:
      secret: "${JWT_SECRET}"
      expiration: "24h"
      refresh_expiration: "7d"
      algorithm: "HS256"
      
    # OAuth2 Providers
    oauth2:
      google:
        enabled: true
        client_id: "${GOOGLE_CLIENT_ID}"
        client_secret: "${GOOGLE_CLIENT_SECRET}"
        scopes: ["openid", "profile", "email"]
        
      github:
        enabled: true
        client_id: "${GITHUB_CLIENT_ID}"
        client_secret: "${GITHUB_CLIENT_SECRET}"
        scopes: ["user:email"]
        
      microsoft:
        enabled: false
        client_id: "${MICROSOFT_CLIENT_ID}"
        client_secret: "${MICROSOFT_CLIENT_SECRET}"
        tenant_id: "${MICROSOFT_TENANT_ID}"
        
    # API Key Management
    api_keys:
      encryption_key: "${API_KEY_ENCRYPTION_KEY}"
      rotation_interval: "30d"
      max_keys_per_user: 5
      
  # Authorization (RBAC)
  authorization:
    roles:
      admin:
        permissions:
          - "system:manage"
          - "users:manage"
          - "providers:manage"
          - "stealth:configure"
          - "audit:view"
          
      manager:
        permissions:
          - "users:view"
          - "providers:view"
          - "conversations:manage"
          - "analytics:view"
          
      user:
        permissions:
          - "conversations:create"
          - "conversations:view_own"
          - "providers:use"
          
      readonly:
        permissions:
          - "conversations:view_own"
          
    # Resource-based permissions
    resources:
      conversations:
        owner_permissions: ["read", "write", "delete", "share"]
        shared_permissions: ["read"]
        
      providers:
        admin_permissions: ["read", "write", "delete", "configure"]
        user_permissions: ["read", "use"]
        
  # Encryption
  encryption:
    # Data at rest
    at_rest:
      algorithm: "AES-256-GCM"
      key_rotation: "90d"
      
    # Data in transit
    in_transit:
      tls_version: "1.3"
      cipher_suites:
        - "TLS_AES_256_GCM_SHA384"
        - "TLS_CHACHA20_POLY1305_SHA256"
        - "TLS_AES_128_GCM_SHA256"
        
    # Database encryption
    database:
      encrypt_sensitive_fields: true
      fields:
        - "api_keys"
        - "passwords"
        - "tokens"
        - "conversation_content"
        
  # Rate Limiting
  rate_limiting:
    # Global limits
    global:
      requests_per_minute: 1000
      requests_per_hour: 10000
      requests_per_day: 100000
      
    # Per-user limits
    per_user:
      admin:
        requests_per_minute: 200
        requests_per_hour: 5000
        
      manager:
        requests_per_minute: 100
        requests_per_hour: 2000
        
      user:
        requests_per_minute: 60
        requests_per_hour: 1000
        
      readonly:
        requests_per_minute: 30
        requests_per_hour: 500
        
    # Per-endpoint limits
    endpoints:
      "/api/chat/completions":
        requests_per_minute: 30
        requests_per_hour: 500
        
      "/api/providers":
        requests_per_minute: 10
        requests_per_hour: 100
        
  # Input Validation
  input_validation:
    # Message content
    messages:
      max_length: 32000
      allowed_formats: ["text", "markdown"]
      sanitize_html: true
      block_scripts: true
      
    # File uploads
    file_uploads:
      enabled: true
      max_size: "10MB"
      allowed_types: ["txt", "md", "pdf", "docx"]
      scan_for_malware: true
      
    # API parameters
    api_parameters:
      strict_validation: true
      reject_unknown_fields: true
      max_nested_depth: 10
      
  # Audit Logging
  audit:
    enabled: true
    
    # Events to log
    events:
      - "user_login"
      - "user_logout"
      - "api_key_created"
      - "api_key_deleted"
      - "provider_added"
      - "provider_modified"
      - "conversation_created"
      - "conversation_deleted"
      - "stealth_detection"
      - "security_violation"
      
    # Log storage
    storage:
      type: "database" # database, file, syslog
      retention: "1y"
      encryption: true
      
    # Log format
    format:
      timestamp: true
      user_id: true
      ip_address: true
      user_agent: true
      request_id: true
      
  # Security Headers
  headers:
    # CORS
    cors:
      allowed_origins: ["https://yourdomain.com"]
      allowed_methods: ["GET", "POST", "PUT", "DELETE"]
      allowed_headers: ["Authorization", "Content-Type"]
      credentials: true
      
    # Security headers
    security_headers:
      x_frame_options: "DENY"
      x_content_type_options: "nosniff"
      x_xss_protection: "1; mode=block"
      strict_transport_security: "max-age=31536000; includeSubDomains"
      content_security_policy: "default-src 'self'; script-src 'self' 'unsafe-inline'"
      
  # Stealth Security Integration
  stealth_security:
    # Detection event handling
    detection_events:
      log_level: "warning"
      alert_threshold: 3
      auto_rotate_profiles: true
      
    # Profile security
    profile_security:
      encrypt_profiles: true
      profile_rotation: "1h"
      max_detection_rate: 0.1
      
    # Session security
    session_security:
      encrypt_sessions: true
      session_timeout: "30m"
      max_concurrent_sessions: 5
